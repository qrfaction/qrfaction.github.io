<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">





  <link rel="alternate" href="/atom.xml" title="qrfaction的博客" type="application/atom+xml">






<meta property="og:type" content="website">
<meta property="og:title" content="qrfaction的博客">
<meta property="og:url" content="https://github.com/qrfaction/qrfaction.github.io/page/3/index.html">
<meta property="og:site_name" content="qrfaction的博客">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="qrfaction的博客">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://github.com/qrfaction/qrfaction.github.io/page/3/">





  <title>qrfaction的博客</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?ce10a2762e71d0513ae5a919b9cf34a5";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">qrfaction的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://github.com/qrfaction/qrfaction.github.io/2018/06/27/attention-is-all-you-need/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="qrfaction">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="qrfaction的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/27/attention-is-all-you-need/" itemprop="url">attention is all you need</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-06-27T11:53:05+08:00">
                2018-06-27
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/NLP/" itemprop="url" rel="index">
                    <span itemprop="name">NLP</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>这篇文章本身是用于seq2seq任务的<br>其中亮点提出了一个Multi-head attention具有相当的启发意义</p>
<h2 id="attention-function"><a href="#attention-function" class="headerlink" title="attention function"></a>attention function</h2><p>给定一个query<br>再给定一组(key,value)对,value可以理解为某个事物的具体信息,key为其关键信息</p>
<p>attention机制就是给出一组权重,使得模型对value的各个部分的关注度不同<br>这个关注度由query和key决定<br>很基本的想法就是和query越相关,权重越大</p>
<p>这里涉及到一个度量函数,常用的有余弦相似度<br><img src="https://raw.githubusercontent.com/qrfaction/qrfaction.github.io/master/2018/06/27/attention-is-all-you-need/attention.jpg" alt="这里写图片描述"><br>Q与K中的各个关键字做相似度计算,再进行权重归一化,对V进行加权求和获得最终内容<br>d<sub>k</sub> 是关键字的维度</p>
<p>获得权重后对value进行加权<br>大部分情况下key=value<br>个人认为当value维度过高时才需要关键信息的提取,这时才会有key和value的不同</p>
<p>当key=value=query时,就是self-attention机制</p>
<h2 id="Multi-Head-Attention"><a href="#Multi-Head-Attention" class="headerlink" title="Multi-Head Attention"></a>Multi-Head Attention</h2><p><img src="https://raw.githubusercontent.com/qrfaction/qrfaction.github.io/master/2018/06/27/attention-is-all-you-need/multi.jpg" alt="这里写图片描述"><br>首先用几个线性变换W将query,key,value映射到多个空间<br>再对他们通过注意力函数提取value的高质量信息</p>
<p>然后用h组线性变换W,进行拼接就得到了multi-head</p>
<h2 id="Transformer"><a href="#Transformer" class="headerlink" title="Transformer"></a>Transformer</h2><p><img src="https://raw.githubusercontent.com/qrfaction/qrfaction.github.io/master/2018/06/27/attention-is-all-you-need/transform.jpg" alt="这里写图片描述"><br>如上便是他的模型结构<br>左边是编码器,右边是解码器</p>
<h3 id="Encoder"><a href="#Encoder" class="headerlink" title="Encoder"></a>Encoder</h3><p>这个编码器由N=6个相同的组件堆叠而成<br>一个组件由两个子层组成</p>
<p>编码器的multi-head attention 是self-attention<br>Add &amp; Norm是指残差连接和layer规范化</p>
<p>Feed Forward是指<br>FFN(x) = max(0,W<sub>1</sub>+b<sub>1</sub>)W<sub>2</sub>+b<sub>2</sub><br>x是词向量</p>
<p>这就相当于两层kernel size = 1的卷积<br>或者时间步上共享权重的全连接层</p>
<h3 id="Decoder"><a href="#Decoder" class="headerlink" title="Decoder"></a>Decoder</h3><p>这个编码器由N=6个相同的组件堆叠而成<br>一个组件由两个子层组成</p>
<p>编码器的multi-head attention 是self-attention<br>Add &amp; Norm是指残差连接和layer规范化</p>
<p>Feed Forward是指<br>FFN(x) = max(0,W<sub>1</sub>+b<sub>1</sub>)W<sub>2</sub>+b<sub>2</sub><br>x是词向量</p>
<p>这就相当于两层kernel size = 1的卷积<br>或者时间步上共享权重的全连接层</p>
<h3 id="output-embedding"><a href="#output-embedding" class="headerlink" title="output embedding"></a>output embedding</h3><p>将上一时刻的预测作为当前输入<br>seq2seq的常用trick</p>
<h3 id="position-embedding"><a href="#position-embedding" class="headerlink" title="position embedding"></a>position embedding</h3><p>由于没有使用conv和rnn所以缺失位置信息<br>于是使用了一系列位置编码<br>其实看不大懂这个东西为啥work = =<br>见图 </p>
<p><img src="https://raw.githubusercontent.com/qrfaction/qrfaction.github.io/master/2018/06/27/attention-is-all-you-need/pos.jpg" alt="这里写图片描述"> </p>
<p>对于一个输入的句子矩阵(句长,词向量维度)<br>和他进行信息结合的是position以上述编码方式生成<br>i是第几个维度,pos是位置,时间轴<br>d<sub>model</sub>是词向量的维度</p>
<p>原本解释说这是因为PE<sub>pos+k</sub>可以表示为PE<sub>pos</sub>的线性函数</p>
<h2 id="finally"><a href="#finally" class="headerlink" title="finally"></a>finally</h2><p>这篇文章算是粗读<br>只理清了模型的推导<br>里面的参数设置和模型训练的具体细节没去纠</p>
<p>这篇文章对attention机制做了一个很好描述</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://github.com/qrfaction/qrfaction.github.io/2018/06/21/siameseRPN/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="qrfaction">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="qrfaction的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/21/siameseRPN/" itemprop="url">2018CVPR之siameseRPN</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-06-21T22:12:22+08:00">
                2018-06-21
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/CV/" itemprop="url" rel="index">
                    <span itemprop="name">CV</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="模型结构"><a href="#模型结构" class="headerlink" title="模型结构"></a>模型结构</h2><p><img src="https://raw.githubusercontent.com/qrfaction/qrfaction.github.io/master/2018/06/21/siameseRPN/model.jpg" alt="这里写图片描述"> </p>
<h3 id="Siamese-FC"><a href="#Siamese-FC" class="headerlink" title="Siamese FC"></a>Siamese FC</h3><p>使用AlexNet去掉conv2和conv4<br>所有卷积不使用padding</p>
<h3 id="Region-Proposal-Network"><a href="#Region-Proposal-Network" class="headerlink" title="Region Proposal Network"></a>Region Proposal Network</h3><p>其实看过faster rcnn 和 siamese fc还是一下子就能理明白的</p>
<ol>
<li>模板帧用卷积抽成4×4×(2k×256)个代表k个anchor+前背景分类</li>
<li>模板帧用卷积抽成4×4×(4k×256)个代表k个anchor+坐标回归<br>然后模板帧的特征图与检测帧的做相关运算进行匹配<br>其中anchor比例为[0.33,0.5,1,2,3]</li>
</ol>
<p>其中回归分支的需要,一些仿射变换用于做数据增强<br>然后proposed至少筛选16个正例,总共64个样本<br>正例IoU阈值为0.6,负例为0.3</p>
<p>然后loss照搬faster rcnn </p>
<h2 id="one-shot-detection"><a href="#one-shot-detection" class="headerlink" title="one-shot detection"></a>one-shot detection</h2><p>检测应用到追踪即为one-shot detection问题</p>
<h3 id="推断"><a href="#推断" class="headerlink" title="推断"></a>推断</h3><p>模板帧在第一帧推断后就不再更新了</p>
<ol>
<li>第一帧的特征更鲁棒</li>
<li>速度快,nn慢就是因为要迭代bp<br>所以这需要大量的数据进行预训练获得通用化的特征</li>
</ol>
<h3 id="proposal-selection"><a href="#proposal-selection" class="headerlink" title="proposal selection"></a>proposal selection</h3><ol>
<li>不选取中心位置离当帧超过七个像素的anchor</li>
<li>给模型的分类置信度加penalty,其中k是超参,r和s分别代表了尺寸和面积,衰减尺度面积变化过大的anchor<br><img src="https://raw.githubusercontent.com/qrfaction/qrfaction.github.io/master/2018/06/21/siameseRPN/penalty.jpg" alt="这里写图片描述"> </li>
<li>选K个分类置信度最高的,进行NMS抑制</li>
<li>最终尺度选定后使用线性插值进行平滑改变</li>
</ol>
<h2 id="other-details"><a href="#other-details" class="headerlink" title="other details"></a>other details</h2><p>使用VID和Youtube-BB数据进行离线训练<br>每次训练模板帧和检测帧之间的时间间隔不超过100帧</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://github.com/qrfaction/qrfaction.github.io/2018/06/07/AUC优化与树模型的那些事/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="qrfaction">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="qrfaction的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/07/AUC优化与树模型的那些事/" itemprop="url">AUC优化与树模型的那些事</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-06-07T11:35:35+08:00">
                2018-06-07
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/ML-DL/" itemprop="url" rel="index">
                    <span itemprop="name">ML&DL</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>最近忽然发现lightgbm中有个梯度优化的loss<br>以前一直好奇树模型如何对auc进行优化<br>于是查了一下,作此博文</p>
<h2 id="AUC在梯度树与DNN中优化的不同之处"><a href="#AUC在梯度树与DNN中优化的不同之处" class="headerlink" title="AUC在梯度树与DNN中优化的不同之处"></a>AUC在梯度树与DNN中优化的不同之处</h2><p>之前我在文章<a href="https://qrfaction.github.io/2018/04/02/end2endAUC/简述了DNN对AUC的优化方式" target="_blank" rel="noopener">https://qrfaction.github.io/2018/04/02/end2endAUC/简述了DNN对AUC的优化方式</a><br>基本就是用一个度量函数将AUC公式中不可微的部分进行平滑</p>
<p>然而在梯度树中这带来了困难<br>见下图<br><img src="https://raw.githubusercontent.com/qrfaction/qrfaction.github.io/master/2018/06/07/AUC优化与树模型的那些事/xgb.jpeg" alt="这里写图片描述"><br>可知梯度树在计算梯度时主要获得的是针对每个样本的梯度信息<br>而原先在DNN中的AUC是无需将梯度细粒度到每个样本<br>只要有一个loss信息回传就OK了</p>
<p>可见原先的方式不再适用</p>
<h2 id="Learning-to-rank-之-LambdaMART"><a href="#Learning-to-rank-之-LambdaMART" class="headerlink" title="Learning to rank 之 LambdaMART"></a>Learning to rank 之 LambdaMART</h2><p>MART其实就是GBDT(他名字很多诶)</p>
<p>这个方法其实是将rankLoss的梯度信息作为模型中的label y<br>即定义了模型的预测score的分数上升方向</p>
<p>首先定义一个rankLoss,其中s<sub>i</sub> , s<sub>j</sub>是模型输出的score<br><img src="https://raw.githubusercontent.com/qrfaction/qrfaction.github.io/master/2018/06/07/AUC优化与树模型的那些事/loss1.jpeg" alt="这里写图片描述"><br><img src="https://raw.githubusercontent.com/qrfaction/qrfaction.github.io/master/2018/06/07/AUC优化与树模型的那些事/loss2.jpeg" alt="这里写图片描述"> </p>
<p>在对s<sub>i</sub>求偏导<br><img src="https://raw.githubusercontent.com/qrfaction/qrfaction.github.io/master/2018/06/07/AUC优化与树模型的那些事/grad.jpeg" alt="这里写图片描述"><br>于是得到了一个s<sub>i</sub>的上升/下降方向<br><img src="https://raw.githubusercontent.com/qrfaction/qrfaction.github.io/master/2018/06/07/AUC优化与树模型的那些事/lambda1.jpeg" alt="这里写图片描述"><br>再令有序对(i,j)的排序label  S<sub>ij</sub> = 1<br><img src="https://raw.githubusercontent.com/qrfaction/qrfaction.github.io/master/2018/06/07/AUC优化与树模型的那些事/lambda.jpeg" alt="这里写图片描述"><br>最后再将λ<sub>i</sub>作为sample i的label<br><img src="https://raw.githubusercontent.com/qrfaction/qrfaction.github.io/master/2018/06/07/AUC优化与树模型的那些事/lambda2.jpeg" alt="这里写图片描述"> </p>
<p>从而实现了树模型的Learning to rank</p>
<p>但这个我感觉应该对auc直接优化有很大帮助<br>因为毕竟auc本身也是一种基于排序的指标<br>但是否具有一致性就不清楚了<br>不过尝试了一下lightgbm中的lambda mart 训练速度超级慢…懒得试了</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://github.com/qrfaction/qrfaction.github.io/2018/06/01/并行数据处理库Dask介绍/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="qrfaction">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="qrfaction的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/01/并行数据处理库Dask介绍/" itemprop="url">并行数据处理库Dask介绍</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-06-01T20:13:39+08:00">
                2018-06-01
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/高性能编程/" itemprop="url" rel="index">
                    <span itemprop="name">高性能编程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>最近有一些临时需求需要并行一些python代码<br>受限于multiprocessing的进程通信限制,不能很方便的通信大矩阵…</p>
<p>今天偶然发现一个Dask库<br>api与numpy,pandas一致,但可以并行计算<br>真的是雪中送炭hh</p>
<h2 id="Dask"><a href="#Dask" class="headerlink" title="Dask"></a>Dask</h2><h3 id="接口介绍"><a href="#接口介绍" class="headerlink" title="接口介绍"></a>接口介绍</h3><p>High Level</p>
<blockquote>
<p>  Arrays: 并行Numpy<br>    Bags: 并行lists<br>    Dataframes: 并行Pandas<br>    Machine Learning : 并行Scikit-Learn<br>    Others from external projects, like XArray</p>
</blockquote>
<p>Low Level</p>
<blockquote>
<p>  Delayed: 用这个装饰器可以用于封装自定义函数来搭建计算图延迟计算<br>    Futures: real-time parallel function evaluation</p>
</blockquote>
<h3 id="计算图搭建与延迟计算"><a href="#计算图搭建与延迟计算" class="headerlink" title="计算图搭建与延迟计算"></a>计算图搭建与延迟计算</h3><p>方式一</p>
<blockquote>
<p>import dask</p>
</blockquote>
<p>lazy_results = []<br>for a in A:<br>&emsp;&emsp;for b in B:<br>&emsp;&emsp;&emsp;&emsp;if a &lt; b:<br>&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;c = dask.delayed(f)(a, b)  # 延迟任务计算,f是自定义函数<br>&emsp;&emsp;&emsp;&emsp;else:<br>&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;c = dask.delayed(g)(a, b)  # 延迟任务计算<br>&emsp;&emsp;&emsp;&emsp;lazy_results.append(c)</p>
<blockquote>
<p>results = dask.compute(*lazy_results)  # 并行计算所有任务</p>
</blockquote>
<p>方式二 </p>
<blockquote>
</blockquote>
<p>@dask.delayed<br>def inc(x):<br>&emsp;&emsp;return x + 1</p>
<blockquote>
</blockquote>
<p>@dask.delayed<br>def add(x, y):<br>&emsp;&emsp;return x + y</p>
<blockquote>
</blockquote>
<p>a = inc(1)       # 放入计算图<br>b = inc(2)       # 放入计算图<br>c = add(a, b)    # 放入计算图</p>
<blockquote>
</blockquote>
<p>c = c.compute()  # 运行计算图并返回结果</p>
<h3 id="Dask中的pandas一览"><a href="#Dask中的pandas一览" class="headerlink" title="Dask中的pandas一览"></a>Dask中的pandas一览</h3><blockquote>
</blockquote>
<p>>&gt;&gt; import dask.dataframe as dd<br>>&gt;&gt; df = dd.read_csv(‘2014-*.csv’)<br>>&gt;&gt; df.head()<br>&emsp;&emsp;&ensp;x&emsp;y<br>&emsp;0&emsp;1&emsp;a<br>&emsp;1&emsp;2&emsp;b<br>&emsp;2&emsp;3&emsp;c<br>&emsp;3&emsp;4&emsp;a<br>&emsp;4&emsp;5&emsp;b<br>&emsp;5&emsp;6&emsp;c</p>
<blockquote>
</blockquote>
<p>>&gt;&gt; df2 = df[df.y == ‘a’].x + 1</p>
<blockquote>
</blockquote>
<p>>&gt;&gt; df2.compute()<br>0&emsp;2<br>3&emsp;5<br>Name: x, dtype: int64</p>
<p>pandas中如下等各类函数皆被加速处理</p>
<p>dd.merge(df1, df2, on=’name’)<br>df.groupby(df.x).apply(myfunc)<br>df[df.x &gt; 0]<br>df.x + df.y<br>等等</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://github.com/qrfaction/qrfaction.github.io/2018/05/31/人脑核磁共振海马体分割竞赛总结/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="qrfaction">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="qrfaction的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/31/人脑核磁共振海马体分割竞赛总结/" itemprop="url">人脑核磁共振海马体分割竞赛总结</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-31T21:49:37+08:00">
                2018-05-31
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/数据竞赛/" itemprop="url" rel="index">
                    <span itemprop="name">数据竞赛</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>最终结果是进决赛拿了二等奖<br>话说一等奖分数比我低很多诶,凭啥他一等= =<br>这个比赛其实从头水到尾,都没干啥事…<br>不过还是挑一些重点的有价值的东西讲讲<br>很多比赛总结其实一直好像是一个比较流水线的报告<br>从预处理到最后的集成<br>即便trick百出,仍似千篇一律</p>
<p>但我仍然喜欢有人能相对于trick提出更多的问题</p>
<p>下面只讲一下个人感觉有价值的东西<br>就不千篇一律的从数据预处理数据增强的一步步介绍了</p>
<h3 id="比赛介绍"><a href="#比赛介绍" class="headerlink" title="比赛介绍"></a>比赛介绍</h3><p>这个比赛是一个3D医学图像分割问题<br>目标是对大脑中的左右海马体进行分割</p>
<h3 id="数据特点"><a href="#数据特点" class="headerlink" title="数据特点"></a>数据特点</h3><p>132组样本<br>3D图像,4D张量,5D一个batchsize<br>十分吃显存<br>卷积核数稍微大一点就给你爆0.1T显存</p>
<p>训练不稳定<br>模型对海马体的差异十分敏感,不同的海马体dice loss差距对比有0.85 , 0.42</p>
<p>验证集阈值浮动<br>由于模型对海马体差异十分敏感<br>所以所以验证集分数经常会从几十跳成0</p>
<p>海马体强度不均<br>一些海马体体素强度在0至200的范围,部分在0至两千的范围</p>
<h3 id="问题的解决方式"><a href="#问题的解决方式" class="headerlink" title="问题的解决方式"></a>问题的解决方式</h3><p>吃显存是真的没法子了<br>只能减通道数<br>毕竟换tesla P40是不可能的,这辈子都不可能换的<br>写插值压小图片又不想写,只能随随便便改改卷积核数才适合我</p>
<p>训练不稳定和验证集阈值浮动提供几个很棒的解决方案</p>
<ol>
<li>改batchsize<br> 将batchsize设置为8问题就被缓解很多了,简单粗暴,但要牺牲一些通道数</li>
<li>将sigmoid激活改成tanh + score map MinMax归一化 + diceLoss<br> 这个方式超级显著,可以说完全解决了这个问题,小batchsize大概要几千轮的样子才能让loss和验证集稳定<br> 这个配合8 batchsize在仅仅600轮即可收敛到88的分数<br> score map MinMax归一化是利用了图片中必定存在海马体的先验信息,即必定存在正例体素</li>
<li>一堆后处理trick(基于梯度,类间方差,类内方差,knn+先验等<br> 在这里我创了很多方法,这个方法有点慢,效果是有的,不如2+1</li>
<li>ConvLSTM<br> 将3D图片的一个轴作为循环轴,利用循环单元拟合,这种结构契合了海马体的形态变化<br> 这个结构分数真的很稳,鲁棒性棒棒哒</li>
<li>在像素级的任务中尽量少用Pool,因为像素级的不对齐任务似乎还是有点影响的</li>
</ol>
<h3 id="summary"><a href="#summary" class="headerlink" title="summary"></a>summary</h3><p>其他的事不想说了,毕竟水过来的,很不认真hh<br>一些数据增强,预处理都不想说了<br>我的几个模型结构也懒得聊,看多了只觉得模型结构要么是拍脑袋拿到的,要么是暴力搜素<br>毕竟缺乏理论性,马后炮式的分析结构是很抗拒的</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://github.com/qrfaction/qrfaction.github.io/2018/05/29/CUDA上下文环境/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="qrfaction">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="qrfaction的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/29/CUDA上下文环境/" itemprop="url">CUDA上下文环境</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-29T14:51:15+08:00">
                2018-05-29
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/高性能编程/" itemprop="url" rel="index">
                    <span itemprop="name">高性能编程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>本篇博客为高性能CUDA应用设计与开发第七章阅读笔记</p>
<h2 id="CUDA上下文环境"><a href="#CUDA上下文环境" class="headerlink" title="CUDA上下文环境"></a>CUDA上下文环境</h2><h4 id="cuda上下文环境"><a href="#cuda上下文环境" class="headerlink" title="cuda上下文环境"></a>cuda上下文环境</h4><p>囊括了所必需的驱动状态信息,如虚拟地址空间,流,事件,已分配的内存块等</p>
<h4 id="GPU设备与上下文"><a href="#GPU设备与上下文" class="headerlink" title="GPU设备与上下文"></a>GPU设备与上下文</h4><p>GPU设备驱动通过设备驱动程序为应用程序提供多个上下文环境<br>就可以使单个CUDA应用程序使用多个设备</p>
<p>同一时刻只能有一个上下文环境处于活动状态<br>所以需要操作多个设备时,需要用cudasetDevice()切换上下文环境</p>
<p>cuda在第一次调用一个改变驱动状态的函数时会自动默认创建一个上下文环境<br>如cudaMalloc()<br>默认在 GPU 0 上创建上下文</p>
<h4 id="上下文与流"><a href="#上下文与流" class="headerlink" title="上下文与流"></a>上下文与流</h4><p>cuda程序通过将操作排队到流中,管理任务和并行<br>创建上下文时会隐式的创建一个流,从而命令可以在设备中排队等待执行<br>cudaMemcpy ,kernel函数等都会自动放入默认流中串行执行</p>
<p>除非指定不同的流,kernel函数流的指定如下<br>kernel&lt;&lt;&lt;nBlocks, nThreadsPerBlocks, 0,stream&gt;&gt;&gt;(para)<br>第三个可填参数是共享内存大小的分配</p>
<p>当kernel函数之间需要并发执行时要使用多个流</p>
<h2 id="任务并发与同步"><a href="#任务并发与同步" class="headerlink" title="任务并发与同步"></a>任务并发与同步</h2><h3 id="显式同步"><a href="#显式同步" class="headerlink" title="显式同步"></a>显式同步</h3><p>cudaEventRecord()<br>我的理解是他是往当前流中异步发送了一个任务(记录时间)<br>由于同一个流中的顺序执行,使得他在之前的任务完成之后才能将传入的事件标记为完成</p>
<p>cudaStreamSynchronize() //同步流与cpu线程<br>cudaDeviceSynchronize() //在cpu线程中同步所有流<br>cudaStreamWaitEvent()   //等待某个事件结束后再执行该流上的任务(这个任务在cudaStreamWaitEvent调用之后指定)<br>cudaStreamQuery()       //查询一个流任务是否完成 </p>
<h3 id="隐式同步"><a href="#隐式同步" class="headerlink" title="隐式同步"></a>隐式同步</h3><p>部分主机操作在其完成前会强制所有流暂停执行<br>在使用下面这些主机操作时需注意,它们可能会停止所有的并发操作</p>
<ol>
<li>页锁定主机内粗的分配</li>
<li>设备内存的分配</li>
<li>设备内存设置</li>
<li>设备到设备的内存拷贝</li>
<li>L1缓存与共享内存之间的配置转换</li>
</ol>
<p>p.s. 我印象中内存的拷贝有异步api的</p>
<h3 id="同一GPU并发执行kernel注意事项"><a href="#同一GPU并发执行kernel注意事项" class="headerlink" title="同一GPU并发执行kernel注意事项"></a>同一GPU并发执行kernel注意事项</h3><p>运行多个kernel会改变索引的局部性<br>增加L2缓存的未命中率,甚至消除缓存的有效性<br>还会引入其他问题<br>如bank冲突和内存分区冲突</p>
<h3 id="内存映射"><a href="#内存映射" class="headerlink" title="内存映射"></a>内存映射</h3><p>这部分书上主要讲了页锁定内存<br>感觉没另一本书讲的详细,之前博客写了不复述了</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://github.com/qrfaction/qrfaction.github.io/2018/05/27/multiprocessing神坑之进程通信/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="qrfaction">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="qrfaction的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/27/multiprocessing神坑之进程通信/" itemprop="url">multiprocessing神坑之进程通信</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-27T12:03:04+08:00">
                2018-05-27
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/高性能编程/" itemprop="url" rel="index">
                    <span itemprop="name">高性能编程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="并发"><a href="#并发" class="headerlink" title="并发"></a>并发</h2><p>python的并发已经被诟病许久了<br>GIL锁导致线程级并发争用一个CPU<br>计算密集型任务在多线程的模式下根本做不到真正意义上的并发<br>导致python的多线程只适用于非计算密集型任务类似I/O等</p>
<p>避开这个劣势一般有两种策略<br>其一是使用multiprocessing将线程级转到进程级<br>其二便是使用C语言</p>
<h2 id="multiprocessing的进程通信方式"><a href="#multiprocessing的进程通信方式" class="headerlink" title="multiprocessing的进程通信方式"></a>multiprocessing的进程通信方式</h2><p>multiprocessing开启一个子进程,两者传参的通信方式是使用pickle将参数序列化</p>
<p>pickle是一种python自带的对象序列化方法,类似json<br>不同之处</p>
<ol>
<li>pickle是python专有,json是通用型序列化方法</li>
<li>pickle编码方式是二进制,便于I/O以及传输,而json可读性较高I/O方面速度较慢</li>
<li>json只能序列化python中的部分对象,而pickle可以序列化大多数</li>
</ol>
<p>在python中使用进程并发时隐藏了这些细节<br>但实际中他是以pickle进行传输数据<br>这就带来了下面的问题</p>
<h2 id="multiprocessing的进程通信限制"><a href="#multiprocessing的进程通信限制" class="headerlink" title="multiprocessing的进程通信限制"></a>multiprocessing的进程通信限制</h2><blockquote>
<p>struct.error: ‘i’ format requires -2147483648 &lt;= number &lt;= 2147483647</p>
</blockquote>
<p>这是我将一个比较大的矩阵作为参数进行传输时带来的问题</p>
<p>其实一个空间占用极大的对象理当不该作为参数传输<br>但是进程不像线程没有共享内存的空间诶,写细了很麻烦<br>再次diss一下Python的并发</p>
<p>这个是触发了多进程中pickle中序列化大小的限制<br>对象过大无法被序列化  = =</p>
<p>如果一些特殊条件导致不方便直接在硬盘上I/O<br>还有什么方法给一个进程传送存储量大的数据呢</p>
<h2 id="multiprocessing的进程的共享对象"><a href="#multiprocessing的进程的共享对象" class="headerlink" title="multiprocessing的进程的共享对象"></a>multiprocessing的进程的共享对象</h2><p>进程的原则本是尽量避免数据共享…<br>但有些情况下又不好避免<br>理当当断则断</p>
<p>multiprocessing中实现了很多用于进程间数据共享的对象<br>如Queue, Array, Value, NameSpace等等</p>
<p>这些对象共享数据的方式是用过创建一个服务进程<br>然后其他进程访问相关数据的某部分时<br>服务进程将这部分数据序列化传输给该进程</p>
<p>这就达到了分批传输的方式</p>
<p>我们这里介绍一个Manager的对象管理方式</p>
<p>创建数据server进程以及给worker进程分配任务</p>
<blockquote>
<p>  with Manager() as manager :<br>    &emsp; &emsp;dataset = manager.list()<br>    &emsp; &emsp;dataset.append(matrix)<br>    &emsp; &emsp;…<br>    &emsp; &emsp;pool.apply_async(worker,args=( dataset, other para))</p>
</blockquote>
<p>worker进程中使用数据</p>
<blockquote>
<p>  def worker(dataset, other para):<br>    &emsp; &emsp;matrix1 = dataset[0]<br>    &emsp; &emsp;matrix2 = dataset[1]<br>    &emsp; &emsp; …</p>
</blockquote>
<p>这与一般的list不同之处在于<br>manager的list对象的数据访问是从server进程上访问的<br>dataset.append(matrix) 通过这行代码将数据分批放入server进程中<br>再在worker进程中 matrix1 = dataset[0] 分批取出</p>
<p>即可避免了过大的数据无法序列化的问题</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://github.com/qrfaction/qrfaction.github.io/2018/05/25/Process/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="qrfaction">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="qrfaction的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/25/Process/" itemprop="url">Dynamic Network Embedding by Modeling Triadic Closure Process阅读笔记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-25T21:51:55+08:00">
                2018-05-25
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/NLP/" itemprop="url" rel="index">
                    <span itemprop="name">NLP</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Network embedding 是表示学习中很重要的一块<br>著名的算法有node2vec,line,SDNE,svd等等<br>这篇论文提出的模型主要是对社交网络中的三角闭包结构和社交网络的时间动态变化建模</p>
<h2 id="Definition"><a href="#Definition" class="headerlink" title="Definition"></a>Definition</h2><p>点集 V = {  v<sub>1</sub>,v<sub>2</sub>,…,v<sub>M</sub> }<br>边集 E = {  e<sub>ij</sub> }  </p>
<p>动态网络 G = { G<sup>1</sup>,G<sup>2</sup>,…,G<sup>T</sup>}<br>G<sup>t</sup> = ( V , E<sup>t</sup> , W<sup>t</sup> ) 表示每个时间段的网络图,W<sup>t</sup>是权重<br>u<sup>t</sup><sub>i</sub> = f<sup>t</sup>(v<sub>i</sub>)  表示学习到的结点v<sub>i</sub>向量 </p>
<h2 id="Triadic-closure-process-三元闭包过程"><a href="#Triadic-closure-process-三元闭包过程" class="headerlink" title="Triadic closure process 三元闭包过程"></a>Triadic closure process 三元闭包过程</h2><p>以社交网络为例<br>( v<sub>i</sub>,v<sub>j</sub>,v<sub>k</sub>)在某时间段是个(open traid)开三角<br>即i,j互不认识,但k认识他俩<br>三元闭包过程就是以预测下一个时间段i,j会相识的概率<br>这个概率取决于k与他们的亲密程度<br>一般来讲越亲密越容易介绍他俩彼此相识<br>亲密程度建模如下,w为权重</p>
<p><img src="http://latex.codecogs.com/gif.latex?x%5Et_%20%7Bijk%7D%20%3D%20w%5Et_%20%7Bik%7D%20*%20%28%20u%5Et_%20%7Bk%7D%20-%20u%5Et_%20%7Bi%7D%20%29%20-%20w%5Et_%20%7Bjk%7D%20*%20%28%20u%5Et_%20%7Bk%7D%20-%20u%5Et_%20%7Bj%7D%29" alt=""></p>
<p>其中下个时间段相识的概率为<br><img src="http://latex.codecogs.com/gif.latex?x%5Et_%20%7Bijk%7D%20%3D%20w%5Et_%20%7Bik%7D%20*%20%28%20u%5Et_%20%7Bk%7D%20-%20u%5Et_%20%7Bi%7D%20%29%20-%20w%5Et_%20%7Bjk%7D%20*%20%28%20u%5Et_%20%7Bk%7D%20-%20u%5Et_%20%7Bj%7D%29" alt=""></p>
<p>极大似然估计<br><img src="http://latex.codecogs.com/gif.latex?%28P%5Et_%7Btr%7D%28i%2Cj%2Ck%29%29%5E%7B%5Calpha_%7Bk%7D%5E%7Bt%2Cj%2Ck%7D%20%7D%20*%20%281-P%5Et_%7Btr%7D%28i%2Cj%2Ck%29%29%29%5E%7B1-%5Calpha_%7Bk%7D%5E%7Bt%2Cj%2Ck%7D%7D" alt=""><br>α<sub>ijk</sub><sup>t</sup> 为label ,下一时刻( v<sub>i</sub>,v<sub>j</sub>,v<sub>k</sub>)为(close traid)闭三角则为1,反之为0</p>
<p>再遍历所有open traid的样本组累乘概率进行极大似然估计<br>loss函数为<br><img src="http://latex.codecogs.com/gif.latex?L%5Et_%7Btr%7D%20%3D-%20%5Csum_%7B%28i%2Cj%29%5Cin%20S_&plus;%7DlogP%5Et_%7Btr&plus;%7D%28i%2Cj%29%20-%20%5Csum_%7B%28i%2Cj%29%5Cin%20S_-%7DlogP%5Et_%7Btr-%7D%28i%2Cj%29" alt=""><br>S<sub>+</sub>  是下一段时刻会变成close traid的样本组集合<br>S<sub>-</sub>  相反</p>
<h2 id="Social-homophily"><a href="#Social-homophily" class="headerlink" title="Social homophily"></a>Social homophily</h2><p><img src="http://latex.codecogs.com/gif.latex?L%5Et_%7Bsh%7D%20%3D%20%5Csum_%7B%28i%2Cj%29%5Cin%20E%5Et_&plus;%20%2C%20%28i%5E%7B%27%7D%2Cj%5E%7B%27%7D%29%20%5Cin%20E%5Et_-%7Dh%28w_%7Bj%2Ck%7D%2C%5Bg%5Et%28j%2Ck%29%20-%20g%5Et%28j%5E%7B%20%27%7D%2Ck%5E%7B%27%7D%29%20&plus;%20%5Cxi%20%5D_&plus;%20%29" alt=""><br>E<sup>t</sup><sub>-</sub> 为E<sup>t</sup>中不存在的边<br>h(w,x) = wx<br>[ x ]<sub>+</sub> = max(0,x)<br>该loss即使用了 tripet loss 期望近邻结点相似,非近邻结点稍远</p>
<h2 id="Temporal-smoothness"><a href="#Temporal-smoothness" class="headerlink" title="Temporal smoothness"></a>Temporal smoothness</h2><p><img src="http://latex.codecogs.com/gif.latex?%24%24%20L%5Et_%7Bsmooth%7D%20%3D%20%5Cbegin%7Bcases%7D%20%5Csum%5EN_%7Bi%3D1%7D%20%7C%7C%20u%5Et_i%20-%20u%5E%7Bt-1%7D_i%20%7C%7C%20%26%20t%3E1%20%5C%5C%200%20%26%20t%3D1%20%5Cend%7Bcases%7D%24%24" alt=""></p>
<p>基于结点随时间的动态变化是平缓的猜想</p>
<h2 id="final"><a href="#final" class="headerlink" title="final"></a>final</h2><p>最终三个loss加权求和即为最终loss</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://github.com/qrfaction/qrfaction.github.io/2018/05/23/PCA实现/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="qrfaction">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="qrfaction的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/23/PCA实现/" itemprop="url">PCA实现</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-23T12:46:03+08:00">
                2018-05-23
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/algorithm/" itemprop="url" rel="index">
                    <span itemprop="name">algorithm</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>由于最近刚好由于要求写了一下PCA<br>其实还是很简单的<br>本篇介绍一个jacobi的方法</p>
<p>令X样本集,行向量为样本,列向量为特征</p>
<ol>
<li><p>先对X的特征进行中心化, 即每一列特征减去其期望(均值)</p>
</li>
<li><p>奇异值分解</p>
<p> X = U<sub>n,n</sub> Σ<sub>n,m</sub> V<sup>T</sup><sub>m,m</sub><br> 选取奇异值最大的 k 个主成分,即<br> X ≈ U<sub>n,k</sub> Σ<sub>k,k</sub> V<sup>T</sup><sub>k,m</sub><br> &lt;=&gt;<br> X V<sub>m,k</sub> ≈ U<sub>n,k</sub> Σ<sub>k,k</sub> </p>
<p> 其中U<sub>n,k</sub> Σ<sub>k,k</sub> 即为X的低维空间投影<br> V<sub>m,k</sub>为降维矩阵<br> 至此PCA过程就结束了</p>
</li>
<li><p>特征值分解与奇异值分解</p>
<p> X<sup>T</sup>X = P λ P<sup>T</sup> = V Σ<sup>T</sup>Σ V<sup>T</sup><br> 其中P是正交阵, λ 为特征值对角正阵, 特征值从大到小排序<br> 所以只需令P = V  , Σ<sup>T</sup>Σ = λ 即可<br> 再用U = Σ<sup>T</sup> V X 即可求出 U </p>
</li>
<li><p>计算特征向量</p>
<p> <img src="https://raw.githubusercontent.com/qrfaction/qrfaction.github.io/master/2018/05/23/PCA实现/givens.jpeg" alt="这里写图片描述"><br> 基本想法是通过不断使用givens变换 (初等旋转变换) 将X的非对角元素变为0<br> P = ∏<sub>i</sub> P<sub>i</sub> (P<sub>i</sub> 是givens变换)<br> P<sup>T </sup>X<sup>T</sup>X P = λ<br> 其中P<sub>i</sub>中未知量的选取见下图<br> <img src="https://raw.githubusercontent.com/qrfaction/qrfaction.github.io/master/2018/05/23/PCA实现/gi2.png" alt="这里写图片描述"><br> <img src="https://raw.githubusercontent.com/qrfaction/qrfaction.github.io/master/2018/05/23/PCA实现/gi3.png" alt="这里写图片描述"> </p>
<p> 接着直至收敛<br> 接着将λ中的特征值从大到小排序,P中的特征向量依据λ的顺序进行排序<br> 从而得到了V</p>
<p> end  很简单hh  从头至尾就是一些矩阵乘法运算<br> givens和X的乘法只涉及到两行两列的元素故为O(n)的复杂度</p>
</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://github.com/qrfaction/qrfaction.github.io/2018/05/19/IndRNN/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="qrfaction">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="qrfaction的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/19/IndRNN/" itemprop="url">IndRNN</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-19T23:15:05+08:00">
                2018-05-19
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/ML-DL/" itemprop="url" rel="index">
                    <span itemprop="name">ML&DL</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>这些天的work和循环单元很相关<br>于是看了这篇很早就想看的IndRNN<br>不得不说work很好看<br>简单but略完美<br>传统循环单元一般只能坚持到几百步长<br>而他能坚持到5000!!!!!!</p>
<p>emmm<br>还有前天和鹏哥在微博上吹逼,吹错了<br>今天细看文章的时候发现的,真是尴尬hh</p>
<h3 id="IndRNN介绍"><a href="#IndRNN介绍" class="headerlink" title="IndRNN介绍"></a>IndRNN介绍</h3><p>IndRNN和传统RNN的定义式区别见下图</p>
<p>RNN<br><img src="https://raw.githubusercontent.com/qrfaction/qrfaction.github.io/master/2018/05/19/IndRNN/rnncell.jpeg" alt="这里写图片描述"><br>IndRNN<br><img src="https://raw.githubusercontent.com/qrfaction/qrfaction.github.io/master/2018/05/19/IndRNN/indrnn.jpeg" alt="这里写图片描述"> </p>
<p>整个区别真的只有矩阵乘法转为hadamard积(对应元素相乘)<br>其中每个h<sub>t</sub>使用的是不同的u向量权重<br>然后IndRNN一般采用relu激活<br>改动虽小,作用却大</p>
<h3 id="梯度分析传统RNN和IndRNN"><a href="#梯度分析传统RNN和IndRNN" class="headerlink" title="梯度分析传统RNN和IndRNN"></a>梯度分析传统RNN和IndRNN</h3><p><img src="https://raw.githubusercontent.com/qrfaction/qrfaction.github.io/master/2018/05/19/IndRNN/rnn.jpeg" alt="这里写图片描述"><br>由梯度计算式可知传统RNN的连乘,由于这个原因导致了梯度爆炸和消失…<br>而再来观察IndRNN梯度的表达式<br><img src="https://raw.githubusercontent.com/qrfaction/qrfaction.github.io/master/2018/05/19/IndRNN/ind.jpeg" alt="这里写图片描述"><br>如果采用relu激活,后面部分的梯度连乘不会造成梯度爆炸<br>而u<sub>n</sub>的大小不会影响到h其他时间步的梯度<br>即由矩阵乘法转为hadamard积将梯度计算在一定程度上隔离开来了<br>u<sub>n</sub>是h<sub>n,t-1</sub>的权重而不会影响到其他时间步</p>
<p>而u只需约束到一个范围即可完美解决梯度消失与爆炸<br>见下图(其实我觉得没屁用,RNN不也可以这样吗)<br><img src="https://raw.githubusercontent.com/qrfaction/qrfaction.github.io/master/2018/05/19/IndRNN/const.jpg" alt="这里写图片描述"> </p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">qrfaction</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">49</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">7</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">19</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">qrfaction</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i> 访问人数
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      人
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
